<!DOCTYPE html><html lang="zh-Hans"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width, initial-scale=0.5"><link rel="stylesheet" href="/css/post.css"><link rel="icon" href="/img/favicon.png"><title>kotlin中链式调用的简单思考</title></head><body>　　<div class="inner"><h2>kotlin中链式调用的简单思考</h2><p>有一个需求，获取app内容的高度，一般我会这样组织代码结构</p>
<ol>
<li>获取手机屏幕高度</li>
<li>如果当前手机状态栏在显示，就减去状态栏高度</li>
<li>如果当前手机虚拟导航栏在显示，就减去导航栏高度</li>
<li>返回处理后的高度</li>
</ol>
<p>我们先假定一些初始值（状态栏是否显示、状态栏高度、导航栏是否显示，导航栏高度等），代码大概是这样:</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> statusBarHeight = <span class="number">32</span> <span class="comment">// we assume the value of statusbar's height is 32</span></span><br><span class="line"><span class="keyword">val</span> navigationBarHeight = <span class="number">128</span> <span class="comment">// we assume the value of nav's height is 128</span></span><br><span class="line"><span class="keyword">val</span> screenHeight = <span class="number">1920</span></span><br><span class="line"><span class="keyword">val</span> statusBarVisible = <span class="literal">true</span></span><br><span class="line"><span class="keyword">val</span> navigationBarVisible = <span class="literal">false</span></span><br></pre></td></tr></table></figure>
<p>以及<br><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">methodWithImperativeStyle</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> contentHeight = screenHeight</span><br><span class="line">    <span class="keyword">if</span> (statusBarVisible) &#123;</span><br><span class="line">        contentHeight -= statusBarHeight</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (navigationBarVisible) &#123;</span><br><span class="line">        contentHeight -= navigationBarHeight</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    println(<span class="string">"contentHeight: <span class="variable">$contentHeight</span>"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>这种写法倾向于面向过程的编程思维，于是，我写了一个支持链式调用的方法，并且把新的获取app内容的高度的实现方式显示如下。</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="type">&lt;T&gt;</span> T.<span class="title">checkAndModify</span><span class="params">(condition: <span class="type">Boolean</span>, modify: (<span class="type">T</span>)</span></span> -&gt; T): T &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">if</span> (condition) &#123;</span><br><span class="line">        modify(<span class="keyword">this</span>)</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">this</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>以及<br><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">methodWithChainedStyle</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">val</span> contentHeight = screenHeight.checkAndModify(statusBarVisible) &#123;</span><br><span class="line">        it - statusBarHeight</span><br><span class="line">    &#125;.checkAndModify(navigationBarVisible) &#123;</span><br><span class="line">        it - navigationBarHeight</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    println(<span class="string">"contentHeight: <span class="variable">$contentHeight</span>"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>大家觉得怎么样？喜欢哪种方法呢？</p>
</div><script src="/js/jquery.min.js"></script><script src="/js/main.js"></script></body></html>